<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .screen {
            display: none;
            width: 100%;
        }

        .screen.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: #16213e;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 700px;
            width: 100%;
            border: 1px solid #0f3460;
        }

        h1 {
            margin-bottom: 30px;
            color: #e94560;
            font-size: 2.2em;
        }

        /* PANTALLA IDIOMA */
        .language-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 30px;
        }

        .language-card {
            background: #0f3460;
            padding: 40px 25px;
            border-radius: 15px;
            cursor: pointer;
            border: 2px solid #1a5f7a;
            transition: all 0.3s;
        }

        .language-card:hover {
            background: #1a5f7a;
            transform: translateY(-8px);
        }

        .language-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .language-card h3 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .language-card p {
            color: #b0b0b0;
            font-size: 1.1em;
        }

        /* PANTALLA MODO DE JUEGO */
        .mode-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 30px;
        }

        .mode-card {
            background: #0f3460;
            padding: 40px 25px;
            border-radius: 15px;
            cursor: pointer;
            border: 2px solid #1a5f7a;
            transition: all 0.3s;
        }

        .mode-card:hover {
            background: #1a5f7a;
            transform: translateY(-8px);
        }

        .mode-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .mode-card h3 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .mode-card p {
            color: #b0b0b0;
            font-size: 1.1em;
        }

        /* PANTALLA MAZOS Y NIVELES */
        .decks, .levels {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .deck, .level {
            background: #0f3460;
            padding: 25px 20px;
            border-radius: 12px;
            cursor: pointer;
            border: 2px solid #1a5f7a;
            transition: all 0.3s;
        }

        .deck:hover, .level:hover {
            background: #1a5f7a;
            transform: translateY(-5px);
        }

        .deck-icon, .level-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .deck h3, .level h3 {
            color: #fff;
            margin-bottom: 8px;
            font-size: 1.3em;
        }

        .deck p, .level p {
            color: #b0b0b0;
            font-size: 0.95em;
        }

        /* PANTALLA JUEGO */
        .progress-bar {
            background: #0f3460;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            background: #e94560;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .score {
            font-size: 1.2em;
            margin: 15px 0;
            color: #b0b0b0;
        }

        .instruction {
            font-size: 1.2em;
            margin: 15px 0;
            color: #b0b0b0;
            font-style: italic;
        }

        .word-display {
            font-size: 3.5em;
            margin: 30px 0;
            color: #fff;
            font-weight: bold;
            background: #0f3460;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #1a5f7a;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .japanese {
            font-family: 'MS Gothic', 'Hiragino Sans', sans-serif;
        }

        .english {
            font-family: 'Arial', sans-serif;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
        }

        .option {
            background: #0f3460;
            border: 2px solid #1a5f7a;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            color: #fff;
            font-size: 1.1em;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .option:hover {
            background: #1a5f7a;
            transform: translateY(-2px);
        }

        .option.correct {
            background: #2e8b57;
            border-color: #2e8b57;
        }

        .option.incorrect {
            background: #dc143c;
            border-color: #dc143c;
        }

        /* Estilos para modo pronunciaci√≥n */
        .input-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        #pronunciation-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #1a5f7a;
            border-radius: 8px;
            background: #0f3460;
            color: white;
            font-size: 1.1em;
        }

        #pronunciation-input::placeholder {
            color: #b0b0b0;
        }

        #pronunciation-input:focus {
            outline: none;
            border-color: #e94560;
        }

        #check-pronunciation-btn {
            background: #1a5f7a;
            white-space: nowrap;
        }

        #check-pronunciation-btn:hover {
            background: #0f3460;
        }

        .feedback {
            margin: 20px 0;
            font-size: 1.3em;
            min-height: 40px;
            font-weight: bold;
        }

        .feedback.correct {
            color: #2e8b57;
        }

        .feedback.incorrect {
            color: #dc143c;
        }

        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px 0;
            transition: background 0.3s;
        }

        button:hover {
            background: #d63447;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .back-btn {
            background: #1a5f7a;
            margin-top: 30px;
        }

        .back-btn:hover {
            background: #0f3460;
        }

        /* PANTALLA RESULTADOS */
        .final-score {
            font-size: 1.5em;
            margin: 20px 0;
            color: #fff;
            background: #0f3460;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #1a5f7a;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 25px 20px;
                margin: 10px;
            }
            
            .language-options, .mode-options {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .language-card, .mode-card {
                padding: 30px 20px;
            }
            
            .decks, .levels {
                grid-template-columns: 1fr;
            }
            
            .word-display {
                font-size: 2.8em;
                padding: 20px;
                min-height: 100px;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .input-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- PANTALLA IDIOMA -->
    <div id="screen-language" class="screen active">
        <div class="container">
            <h1>üåç Elige Idioma</h1>
            <div class="language-options">
                <div class="language-card" id="japanese-btn">
                    <div class="language-icon">üéå</div>
                    <h3>Japon√©s</h3>
                    <p>6 mazos de vocabulario</p>
                </div>
                <div class="language-card" id="english-btn">
                    <div class="language-icon">üá¨üáß</div>
                    <h3>Ingl√©s</h3>
                    <p>6 niveles de proficiency</p>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA MODO DE JUEGO -->
    <div id="screen-game-mode" class="screen">
        <div class="container">
            <h1 id="mode-title">üéå Elige Modo de Juego</h1>
            <div class="mode-options">
                <div class="mode-card" id="quiz-mode-btn">
                    <div class="mode-icon">‚ùì</div>
                    <h3>Modo Quiz</h3>
                    <p>Elige la opci√≥n correcta entre m√∫ltiples opciones</p>
                </div>
                <div class="mode-card" id="pronunciation-mode-btn">
                    <div class="mode-icon">üé§</div>
                    <h3>Modo Pronunciaci√≥n</h3>
                    <p>Escribe la palabra correcta</p>
                </div>
            </div>
            <button class="back-btn" id="back-from-mode">‚Üê Volver</button>
        </div>
    </div>

    <!-- PANTALLA MAZOS JAPON√âS -->
    <div id="screen-japanese-decks" class="screen">
        <div class="container">
            <h1>üéå Mazos Japoneses</h1>
            <div class="decks">
                <div class="deck" data-deck="basico">
                    <div class="deck-icon">üéØ</div>
                    <h3>B√°sico</h3>
                    <p>Palabras fundamentales N5</p>
                </div>
                <div class="deck" data-deck="intermedio">
                    <div class="deck-icon">‚ö°</div>
                    <h3>Intermedio</h3>
                    <p>Vocabulario N4-N3</p>
                </div>
                <div class="deck" data-deck="avanzado">
                    <div class="deck-icon">üî•</div>
                    <h3>Avanzado</h3>
                    <p>Palabras complejas N3-N2</p>
                </div>
                <div class="deck" data-deck="kanji">
                    <div class="deck-icon">üñãÔ∏è</div>
                    <h3>Kanji</h3>
                    <p>Caracteres esenciales</p>
                </div>
                <div class="deck" data-deck="verbos">
                    <div class="deck-icon">üî§</div>
                    <h3>Verbos</h3>
                    <p>Acciones y conjugaciones</p>
                </div>
                <div class="deck" data-deck="avanzado2">
                    <div class="deck-icon">üéØ</div>
                    <h3>Expert</h3>
                    <p>Nivel nativo N2-N1</p>
                </div>
            </div>
            <button class="back-btn" id="back-from-japanese">‚Üê Volver</button>
        </div>
    </div>

    <!-- PANTALLA NIVELES INGL√âS -->
    <div id="screen-english-levels" class="screen">
        <div class="container">
            <h1>üá¨üáß Niveles de Ingl√©s</h1>
            <div class="levels">
                <div class="level" data-level="a1">
                    <div class="level-icon">üü¢</div>
                    <h3>A1 - Beginner</h3>
                    <p>Vocabulario b√°sico</p>
                </div>
                <div class="level" data-level="a2">
                    <div class="level-icon">üü°</div>
                    <h3>A2 - Elementary</h3>
                    <p>Frases simples</p>
                </div>
                <div class="level" data-level="b1">
                    <div class="level-icon">üü†</div>
                    <h3>B1 - Intermediate</h3>
                    <p>Conversaciones cotidianas</p>
                </div>
                <div class="level" data-level="b2">
                    <div class="level-icon">üîµ</div>
                    <h3>B2 - Upper Intermediate</h3>
                    <p>Debates y discusiones</p>
                </div>
                <div class="level" data-level="c1">
                    <div class="level-icon">üü£</div>
                    <h3>C1 - Advanced</h3>
                    <p>Lenguaje acad√©mico</p>
                </div>
                <div class="level" data-level="c2">
                    <div class="level-icon">üî¥</div>
                    <h3>C2 - Proficient</h3>
                    <p>Nivel nativo</p>
                </div>
            </div>
            <button class="back-btn" id="back-from-english">‚Üê Volver</button>
        </div>
    </div>

    <!-- PANTALLA JUEGO -->
    <div id="screen-game" class="screen">
        <div class="container">
            <h1 id="game-title">üéå Quiz</h1>
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
            <div id="score" class="score">Puntuaci√≥n: 0/0</div>
            
            <!-- Elemento para mostrar instrucciones -->
            <div id="game-instruction" class="instruction"></div>
            
            <div id="word-display" class="word-display">Ê∫ñÂÇô‰∏≠</div>
            
            <!-- Secci√≥n para modo quiz (opciones m√∫ltiples) -->
            <div id="quiz-section">
                <div id="options" class="options"></div>
            </div>
            
            <!-- Secci√≥n para modo pronunciaci√≥n (input texto) -->
            <div id="pronunciation-section" style="display: none;">
                <div class="input-container">
                    <input type="text" id="pronunciation-input" placeholder="Escribe la palabra aqu√≠...">
                    <button id="check-pronunciation-btn">Comprobar</button>
                </div>
            </div>
            
            <div id="feedback" class="feedback"></div>
            <button id="next-btn">Siguiente ‚Üí</button>
        </div>
    </div>

    <!-- PANTALLA RESULTADOS -->
    <div id="screen-results" class="screen">
        <div class="container">
            <h1>üéâ ¬°Completado!</h1>
            <div id="final-score" class="final-score"></div>
            <button id="back-to-selection">Volver a Selecci√≥n</button>
        </div>
    </div>

    <script>
        // Base de datos expandida
        const japaneseDecks = {
            basico: [
                { word: "Â≠¶Ê†°", translation: "escuela" },
                { word: "Êú¨", translation: "libro" },
                { word: "Ê∞¥", translation: "agua" },
                { word: "Áå´", translation: "gato" },
                { word: "Áä¨", translation: "perro" },
                { word: "Êâã", translation: "mano" }
            ],
            intermedio: [
                { word: "‰ºùË™¨", translation: "leyenda" },
                { word: "ÂóúÂ•Ω", translation: "preferencia" },
                { word: "Â§ß‰Ωì", translation: "aproximadamente" },
                { word: "ÊÑüËß¶", translation: "sensaci√≥n" },
                { word: "Áãê", translation: "zorro" },
                { word: "Á©∫", translation: "cielo" }
            ],
            avanzado: [
                { word: "ÂæÆÂ¶ô", translation: "delicado" },
                { word: "ÁüõÁõæ", translation: "contradicci√≥n" },
                { word: "ÁµÜ", translation: "v√≠nculo" },
                { word: "ÁÑ°ÈßÑ", translation: "in√∫til" },
                { word: "ÂæÆÂ¶ô", translation: "sutil" },
                { word: "ËßâÊÇü", translation: "determinaci√≥n" }
            ],
            kanji: [
                { word: "ÊÑõ", translation: "amor" },
                { word: "Â§¢", translation: "sue√±o" },
                { word: "Âäõ", translation: "poder" },
                { word: "Áæé", translation: "belleza" },
                { word: "ÂøÉ", translation: "coraz√≥n" },
                { word: "ÈÅì", translation: "camino" }
            ],
            verbos: [
                { word: "È£ü„Åπ„Çã", translation: "comer" },
                { word: "È£≤„ÇÄ", translation: "beber" },
                { word: "Ë°å„Åè", translation: "ir" },
                { word: "Êù•„Çã", translation: "venir" },
                { word: "Ë¶ã„Çã", translation: "ver" },
                { word: "Ë©±„Åô", translation: "hablar" }
            ],
            avanzado2: [
                { word: "Áµ¢Áàõ", translation: "brillante" },
                { word: "ÈÇÇÈÄÖ", translation: "encuentro" },
                { word: "ÂàπÈÇ£", translation: "momento" },
                { word: "ÊÇ†‰πÖ", translation: "eternidad" },
                { word: "Ê∑∑Ê≤å", translation: "caos" },
                { word: "Ëº™Âªª", translation: "reencarnaci√≥n" }
            ]
        };

        const englishLevels = {
            a1: [
                { word: "Hello", translation: "Hola" },
                { word: "Goodbye", translation: "Adi√≥s" },
                { word: "Thank you", translation: "Gracias" },
                { word: "Please", translation: "Por favor" },
                { word: "Yes", translation: "S√≠" },
                { word: "No", translation: "No" }
            ],
            a2: [
                { word: "House", translation: "Casa" },
                { word: "Family", translation: "Familia" },
                { word: "Food", translation: "Comida" },
                { word: "Water", translation: "Agua" },
                { word: "Friend", translation: "Amigo" },
                { word: "School", translation: "Escuela" }
            ],
            b1: [
                { word: "Actually", translation: "En realidad" },
                { word: "Although", translation: "Aunque" },
                { word: "Because", translation: "Porque" },
                { word: "However", translation: "Sin embargo" },
                { word: "Therefore", translation: "Por lo tanto" },
                { word: "Meanwhile", translation: "Mientras tanto" }
            ],
            b2: [
                { word: "Accomplish", translation: "Lograr" },
                { word: "Significant", translation: "Significativo" },
                { word: "Furthermore", translation: "Adem√°s" },
                { word: "Nevertheless", translation: "No obstante" },
                { word: "Consequently", translation: "En consecuencia" },
                { word: "Ultimately", translation: "Finalmente" }
            ],
            c1: [
                { word: "Ambiguous", translation: "Ambiguo" },
                { word: "Comprehensive", translation: "Exhaustivo" },
                { word: "Substantial", translation: "Sustancial" },
                { word: "Nevertheless", translation: "Sin embargo" },
                { word: "Consequently", translation: "En consecuencia" },
                { word: "Furthermore", translation: "Adem√°s" }
            ],
            c2: [
                { word: "Ubiquitous", translation: "Ubicuo" },
                { word: "Meticulous", translation: "Meticuloso" },
                { word: "Pragmatic", translation: "Pragm√°tico" },
                { word: "Inevitable", translation: "Inevitable" },
                { word: "Paradigm", translation: "Paradigma" },
                { word: "Quintessential", translation: "Quintaesencia" }
            ]
        };

        // Variables del juego
        let currentDeck = [];
        let usedWords = [];
        let score = 0;
        let totalQuestions = 0;
        let currentCorrectAnswer = "";
        let currentType = ""; // 'japanese' o 'english'
        let currentGameMode = ''; // 'quiz' o 'pronunciation'
        let currentInstruction = '';

        // Elementos del DOM
        const screens = {
            language: document.getElementById('screen-language'),
            gameMode: document.getElementById('screen-game-mode'),
            japaneseDecks: document.getElementById('screen-japanese-decks'),
            englishLevels: document.getElementById('screen-english-levels'),
            game: document.getElementById('screen-game'),
            results: document.getElementById('screen-results')
        };

        // Inicializar eventos cuando la p√°gina cargue
        document.addEventListener('DOMContentLoaded', function() {
            // Botones de idioma
            document.getElementById('japanese-btn').addEventListener('click', function() {
                currentType = 'japanese';
                showScreen('gameMode');
            });
            
            document.getElementById('english-btn').addEventListener('click', function() {
                currentType = 'english';
                showScreen('gameMode');
            });

            // Botones de modo de juego
            document.getElementById('quiz-mode-btn').addEventListener('click', function() {
                currentGameMode = 'quiz';
                if (currentType === 'japanese') {
                    showScreen('japaneseDecks');
                } else {
                    showScreen('englishLevels');
                }
            });
            
            document.getElementById('pronunciation-mode-btn').addEventListener('click', function() {
                currentGameMode = 'pronunciation';
                if (currentType === 'japanese') {
                    showScreen('japaneseDecks');
                } else {
                    showScreen('englishLevels');
                }
            });

            // Botones de volver
            document.getElementById('back-from-mode').addEventListener('click', function() {
                showScreen('language');
            });
            
            document.getElementById('back-from-japanese').addEventListener('click', function() {
                showScreen('gameMode');
            });
            
            document.getElementById('back-from-english').addEventListener('click', function() {
                showScreen('gameMode');
            });

            // Bot√≥n siguiente pregunta
            document.getElementById('next-btn').addEventListener('click', nextQuestion);

            // Bot√≥n volver a selecci√≥n desde resultados
            document.getElementById('back-to-selection').addEventListener('click', backToSelection);

            // Eventos para mazos japoneses
            document.querySelectorAll('#screen-japanese-decks .deck').forEach(deck => {
                deck.addEventListener('click', function() {
                    const deckName = this.getAttribute('data-deck');
                    selectDeck(deckName, 'japanese');
                });
            });

            // Eventos para niveles ingl√©s
            document.querySelectorAll('#screen-english-levels .level').forEach(level => {
                level.addEventListener('click', function() {
                    const levelName = this.getAttribute('data-level');
                    selectLevel(levelName, 'english');
                });
            });

            // Bot√≥n comprobar pronunciaci√≥n
            document.getElementById('check-pronunciation-btn').addEventListener('click', checkPronunciation);

            // Permitir Enter en el input
            document.getElementById('pronunciation-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPronunciation();
                }
            });

            // Mostrar pantalla inicial
            showScreen('language');
        });

        // Cambiar pantalla
        function showScreen(screenName) {
            // Ocultar todas las pantallas
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Mostrar la pantalla solicitada
            screens[screenName].classList.add('active');
        }

        // Seleccionar mazo japon√©s
        function selectDeck(deckName, type) {
            currentDeck = japaneseDecks[deckName];
            currentType = type;
            startGame();
        }

        // Seleccionar nivel ingl√©s
        function selectLevel(levelName, type) {
            currentDeck = englishLevels[levelName];
            currentType = type;
            startGame();
        }

        // Iniciar juego
        function startGame() {
            usedWords = [];
            score = 0;
            totalQuestions = 0;
            
            // Configurar seg√∫n el modo
            const quizSection = document.getElementById('quiz-section');
            const pronunciationSection = document.getElementById('pronunciation-section');
            const instruction = document.getElementById('game-instruction');
            
            if (currentGameMode === 'quiz') {
                quizSection.style.display = 'block';
                pronunciationSection.style.display = 'none';
                instruction.textContent = 'Elige la traducci√≥n correcta:';
            } else {
                quizSection.style.display = 'none';
                pronunciationSection.style.display = 'block';
                instruction.textContent = currentType === 'japanese' 
                    ? 'Escribe la lectura en romaji o la traducci√≥n:' 
                    : 'Escribe la palabra en ingl√©s:';
            }
            
            // Actualizar t√≠tulo
            const gameTitle = document.getElementById('game-title');
            gameTitle.textContent = currentType === 'japanese' 
                ? `üéå ${currentGameMode === 'quiz' ? 'Quiz Japon√©s' : 'Pronunciaci√≥n Japonesa'}` 
                : `üá¨üáß ${currentGameMode === 'quiz' ? 'Quiz Ingl√©s' : 'Pronunciaci√≥n Inglesa'}`;
            
            showScreen('game');
            nextQuestion();
        }

        // Siguiente pregunta
        function nextQuestion() {
            const wordDisplay = document.getElementById('word-display');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const scoreElement = document.getElementById('score');
            const progress = document.getElementById('progress');
            const pronunciationInput = document.getElementById('pronunciation-input');

            // Resetear
            feedback.textContent = '';
            feedback.className = 'feedback';
            nextBtn.disabled = true;
            wordDisplay.className = 'word-display ' + currentType;
            pronunciationInput.value = '';
            pronunciationInput.disabled = false;
            document.getElementById('check-pronunciation-btn').disabled = false;

            // Verificar si termin√≥
            if (usedWords.length >= currentDeck.length) {
                showResults();
                return;
            }

            // Obtener palabra aleatoria
            let randomWord;
            do {
                randomWord = currentDeck[Math.floor(Math.random() * currentDeck.length)];
            } while (usedWords.includes(randomWord.word));

            usedWords.push(randomWord.word);
            currentCorrectAnswer = randomWord.translation;

            // Mostrar palabra seg√∫n el modo
            if (currentGameMode === 'quiz') {
                wordDisplay.textContent = randomWord.word;
                generateQuizOptions(randomWord);
            } else {
                // En modo pronunciaci√≥n, mostramos la traducci√≥n y el usuario escribe la palabra original
                wordDisplay.textContent = randomWord.translation;
                currentCorrectAnswer = randomWord.word.toLowerCase(); // Para comparaci√≥n case-insensitive
            }

            // Actualizar UI
            totalQuestions++;
            scoreElement.textContent = `Puntuaci√≥n: ${score}/${totalQuestions-1}`;
            progress.style.width = `${(usedWords.length / currentDeck.length) * 100}%`;
        }

        // Generar opciones para modo quiz
        function generateQuizOptions(randomWord) {
            const options = document.getElementById('options');
            const allOptions = [randomWord.translation];
            
            while (allOptions.length < 4) {
                const randomOption = currentDeck[Math.floor(Math.random() * currentDeck.length)].translation;
                if (!allOptions.includes(randomOption)) {
                    allOptions.push(randomOption);
                }
            }

            allOptions.sort(() => Math.random() - 0.5);
            options.innerHTML = '';
            
            allOptions.forEach(option => {
                const button = document.createElement('div');
                button.className = 'option';
                button.textContent = option;
                button.addEventListener('click', function() {
                    checkAnswer(option, button);
                });
                options.appendChild(button);
            });
        }

        // Verificar respuesta para modo quiz
        function checkAnswer(selected, element) {
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');

            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });

            if (selected === currentCorrectAnswer) {
                element.classList.add('correct');
                feedback.textContent = '¬°Correcto! üéâ';
                feedback.className = 'feedback correct';
                score++;
                nextBtn.disabled = false;
                
                options.forEach(opt => {
                    if (opt.textContent === currentCorrectAnswer) {
                        opt.classList.add('correct');
                    }
                });
                
            } else {
                element.classList.add('incorrect');
                feedback.textContent = 'Incorrecto ‚ùå Intenta de nuevo';
                feedback.className = 'feedback incorrect';

                setTimeout(() => {
                    if (!nextBtn.disabled) return;
                    options.forEach(opt => {
                        opt.style.pointerEvents = 'auto';
                        opt.classList.remove('incorrect');
                    });
                    feedback.textContent = '¬°Elige otra opci√≥n!';
                    feedback.classList.remove('incorrect');
                }, 1000);
            }

            document.getElementById('score').textContent = `Puntuaci√≥n: ${score}/${totalQuestions}`;
        }

        // Verificar pronunciaci√≥n para modo escritura
        function checkPronunciation() {
            const pronunciationInput = document.getElementById('pronunciation-input');
            const userAnswer = pronunciationInput.value.trim().toLowerCase();
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');

            if (userAnswer === '') {
                feedback.textContent = 'Por favor, escribe una respuesta';
                feedback.className = 'feedback incorrect';
                return;
            }

            // Deshabilitar input y bot√≥n
            pronunciationInput.disabled = true;
            document.getElementById('check-pronunciation-btn').disabled = true;

            if (userAnswer === currentCorrectAnswer.toLowerCase()) {
                feedback.textContent = '¬°Correcto! üéâ';
                feedback.className = 'feedback correct';
                score++;
                nextBtn.disabled = false;
            } else {
                feedback.textContent = `Incorrecto ‚ùå La respuesta era: ${currentCorrectAnswer}`;
                feedback.className = 'feedback incorrect';
                nextBtn.disabled = false;
            }

            document.getElementById('score').textContent = `Puntuaci√≥n: ${score}/${totalQuestions}`;
        }

        // Mostrar resultados
        function showResults() {
            const finalScore = document.getElementById('final-score');
            finalScore.textContent = `Puntuaci√≥n final: ${score}/${currentDeck.length}`;
            showScreen('results');
        }

        // Volver a selecci√≥n
        function backToSelection() {
            if (currentType === 'japanese') {
                showScreen('japaneseDecks');
            } else {
                showScreen('englishLevels');
            }
        }
    </script>
</body>
</html>
